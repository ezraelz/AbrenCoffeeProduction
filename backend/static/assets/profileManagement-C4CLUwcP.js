import{r as i,a as k,j as e,i as x,y as g,k as w,X as C,Y as A,I}from"./index-CWz2hUUw.js";import _ from"./adminPage-3HDgvPqh.js";import{C as $}from"./confirmDelete-BQR_ZiPk.js";import"./index-6ixtpVPY.js";const y=()=>{const[t,l]=i.useState(null),[o,r]=i.useState(null),n=k();return i.useEffect(()=>{(async()=>{const c=localStorage.getItem("access_token");if(!c){r("You must be logged in to view your profile.");return}try{const j=await x.get("/users/me/",{headers:{Authorization:`Bearer ${c}`}});l(j.data)}catch{r("Failed to load profile.")}})()},[n]),o?e.jsx("div",{className:"error-message",children:o}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"heading",children:e.jsx("h1",{children:"Profile"})}),e.jsxs("div",{className:"profile-detail",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",t==null?void 0:t.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",t==null?void 0:t.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date Joined:"})," ",t==null?void 0:t.date_joined]})]})]})},P=()=>{const[t,l]=i.useState(null);return i.useEffect(()=>{(async()=>{const r=localStorage.getItem("access_token");if(r)try{const n=await x.get("/orders/shipping/user/",{headers:{Authorization:`Bearer ${r}`}});console.log("Shipping Response:",n.data),Array.isArray(n.data)&&n.data.length>0?l(n.data[0]):l(null)}catch{g.error("Shipping fetch failed:")}})()},[]),e.jsx("div",{children:e.jsxs("div",{className:"profile-shipping-container",children:[e.jsx("h2",{children:"Shipping Address"}),t?e.jsxs("div",{className:"shipping-details",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",t.full_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",t.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address 1:"})," ",t.address1]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address 2:"})," ",t.address2]}),e.jsxs("p",{children:[e.jsx("strong",{children:"City:"})," ",t.city]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",t.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Zipcode:"})," ",t.zipcode]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Country:"})," ",t.country]})]}):e.jsx("p",{className:"no-address",children:"No shipping address found."})]})})},D=()=>{const[t,l]=i.useState([]),o=async()=>{const r=localStorage.getItem("access_token"),n=await x.get("/orders/invoices/user/",{headers:r?{Authorization:`Bearer ${r}`}:{}});l(n.data)};return i.useEffect(()=>{o()},[]),e.jsxs("div",{className:"invoices-container",children:[e.jsx("h1",{children:"All Invoices"}),e.jsxs("table",{className:"invoices-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Invoice ID"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.id}),e.jsx("td",{children:new Date(r.created_at).toLocaleDateString()}),e.jsx("td",{children:r.status}),e.jsxs("td",{className:"action-buttons",children:[e.jsx("button",{onClick:()=>alert(`Viewing ${r.id}`),children:"View"}),e.jsx("button",{onClick:()=>alert(`Editing ${r.id}`),children:"Edit"}),e.jsx("button",{onClick:()=>alert(`Deleting ${r.id}`),children:"Delete"}),r.pdf_file&&e.jsx("a",{href:r.pdf_file,target:"_blank",rel:"noopener noreferrer",download:!0,className:"download-link",children:e.jsx("button",{children:"Download"})})]})]},r.id))})]}),t.length===0&&e.jsx("p",{children:"No invoices found."})]})},E=()=>{const[t,l]=i.useState([]),[o,r]=i.useState(1),n=k(),u=5;i.useEffect(()=>{(async()=>{const h=localStorage.getItem("access_token"),a=await x.get("/orders/list/",{headers:{Authorization:`Bearer ${h}`}});l(a.data),console.log(a.data)})()},[]);const c=t,j=o*u,m=j-u,f=c.slice(m,j),b=Math.ceil(c.length/u),v=async s=>{try{const h=localStorage.getItem("access_token");await x.post(`/orders/${s}/cancel/`,{},{headers:{Authorization:`Bearer ${h}`}}),g.success("Order cancelled and stock restored."),l(a=>a.filter(d=>d.id!==s))}catch{g.error("Failed to cancel order.")}},p=async s=>{try{const h=localStorage.getItem("access_token");await x.post(`/orders/request-refund/${s}/`,{},{headers:{Authorization:`Bearer ${h}`}}),g.success("Refund request sent!"),l(a=>a.map(d=>d.id===s?{...d,refundRequested:!0}:d))}catch{g.error("Failed to request refund.")}};return e.jsxs("div",{className:"order-list",children:[e.jsx("h1",{children:"All Orders"}),e.jsx("div",{className:"order-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Total price"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:f.length>0?f.map((s,h)=>e.jsxs("tr",{children:[e.jsx("td",{children:h+1+(o-1)*u}),e.jsx("td",{children:s.status}),e.jsx("td",{children:s.total_price}),e.jsxs("td",{children:[s.status==="pending"?e.jsxs("div",{className:"pending-order-actions",children:[e.jsx("button",{onClick:()=>n("/shop/checkout/payment",{state:{orderId:s.id}}),className:"btn-primary",children:"💳 Resume Payment"}),e.jsx("button",{onClick:()=>v(s.id),className:"btn-secondary",children:"❌ Cancel Order"})]}):e.jsx("button",{className:"btn-edit",title:"View Order",onClick:()=>alert(`View details for order ${s.id}`),children:"✏️ Info"}),s.status==="delivered"&&!s.refundRequested&&e.jsx("button",{onClick:()=>p(s.id),children:"Request Refund"})]})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No Orders found."})})})]})}),e.jsx("div",{className:"pagination",children:[...Array(b).keys()].map(s=>e.jsx("button",{onClick:()=>r(s+1),className:o===s+1?"active":"",children:s+1},s+1))})]})},S=5,O=()=>{const[t,l]=i.useState([]),[o,r]=i.useState(!1),[n,u]=i.useState(null),[c,j]=i.useState(1),m=k(),{addItem:f}=w();i.useEffect(()=>{(async()=>{const d=localStorage.getItem("access_token");try{const N=await x.get("/wishlist/list/",{headers:{Authorization:`Bearer ${d}`}});l(N.data),console.log(N.data)}catch{console.error("❌ Failed to load wishlist.")}})()},[]);const b=a=>{u(a),r(!0)},v=async()=>{if(!n)return;r(!1);const a=localStorage.getItem("access_token");try{await x.delete(`/wishlist/delete/${n}/`,{headers:{Authorization:`Bearer ${a}`}}),l(d=>d.filter(N=>N.id!==n)),g.success("✅ Item removed from wishlist!")}catch{g.error("❌ Failed to delete item.")}},p=Math.ceil(t.length/S),s=(c-1)*S,h=t.slice(s,s+S);return e.jsx("div",{className:"wishlist",children:e.jsxs("div",{className:"wishlist-container",children:[e.jsx("h2",{className:"wishlist-header",children:"Your Wishlist"}),t.length===0?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Your Wishlist is empty."}),e.jsx("button",{className:"button-shop",onClick:()=>m("/shop"),children:"Go to Shop"})]}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"wish-items-list",children:h.map(a=>e.jsxs("li",{className:"wish-item",children:[e.jsx("img",{src:`http://127.0.0.1:8000/${a.product.image}`,alt:a.product.name,onError:d=>d.currentTarget.src="/images/placeholder.jpg",className:"cart-item-image"}),e.jsxs("div",{className:"wish-item-info",children:[e.jsxs("span",{className:"cart-item-name",children:[a.product.name," - $",a.product.price]}),e.jsxs("div",{className:"cart-item-controls",children:[e.jsx("button",{onClick:()=>f({...a.product,stock:1,quantity:1}),children:"Add to Cart"}),e.jsx("button",{onClick:()=>m(`/product/${a.product.id}`),children:"View"}),e.jsx("button",{onClick:()=>b(a.id),children:"🗑️"})]})]})]},a.id))}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>j(a=>Math.max(a-1,1)),disabled:c===1,children:"Previous"}),[...Array(p)].map((a,d)=>e.jsx("button",{className:c===d+1?"active":"",onClick:()=>j(d+1),children:d+1},d+1)),e.jsx("button",{onClick:()=>j(a=>Math.min(a+1,p)),disabled:c===p,children:"Next"})]}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{onClick:()=>m("/shop"),children:"Continue Shopping"}),e.jsx("button",{onClick:()=>m("/cart"),children:"View Cart"})]})]}),e.jsx($,{isOpen:o,title:"Remove from Wishlist",message:"Are you sure you want to remove this item?",onConfirm:v,onCancel:()=>r(!1)})]})})},F=()=>{const[t,l]=i.useState([]),o=async()=>{const n=await x.get("/my-subscriptions/");l(n.data)},r=async n=>{await x.post(`/subscriptions/${n}/cancel/`),l(u=>u.map(c=>c.id===n?{...c,active:!1}:c))};return i.useEffect(()=>{o()},[]),e.jsxs("div",{className:"subscription-dashboard",children:[e.jsx("h2",{children:"My Subscriptions"}),t.length===0?e.jsx("p",{children:"No subscriptions found."}):e.jsxs("table",{className:"subscription-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Provider"}),e.jsx("th",{children:"Subscription ID"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Started At"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.map(n=>e.jsxs("tr",{children:[e.jsx("td",{children:n.provider}),e.jsx("td",{children:n.external_id}),e.jsx("td",{children:e.jsx("span",{className:n.active?"badge active":"badge inactive",children:n.active?"Active":"Cancelled"})}),e.jsx("td",{children:new Date(n.created_at).toLocaleDateString()}),e.jsx("td",{children:n.active&&e.jsx("button",{onClick:()=>r(n.id),className:"cancel-btn",children:"Cancel"})})]},n.id))})]})]})},M=()=>{const[t,l]=i.useState("profile"),[o,r]=i.useState(null),[n,u]=i.useState(null),[c,j]=i.useState(!1),m=k(),f=()=>{j(!c)};i.useEffect(()=>{(async()=>{const s=localStorage.getItem("access_token");if(!s){u("You must be logged in to view your profile."),m("/login");return}try{const h=await x.get("/users/me/",{headers:{Authorization:`Bearer ${s}`}});r(h.data)}catch{u("Failed to load profile."),m("/login")}})()},[m]),i.useEffect(()=>{(async()=>{const s=localStorage.getItem("access_token");try{await x.get("/users/me/",{headers:{Authorization:`Bearer ${s}`}})}catch{localStorage.removeItem("access_token"),g.error("Failed to load profile.")}})()},[]);const b=()=>{const p=[{name:"profile"},{name:"shipping address"},{name:"orders"},{name:"wishlist"},{name:"invoices"},{name:"subscriptions"}].filter(s=>s.name);return e.jsx("div",{className:c?"profile-tab-container small":"profile-tab-container",children:p.map((s,h)=>e.jsx("button",{onClick:()=>{l(s.name)},className:t===s.name?"active":"",children:s.name},h))})},v=()=>{switch(t){case"Profile":return e.jsx(y,{});case"shipping address":return e.jsx(P,{});case"dashboard":return e.jsx(_,{});case"invoices":return e.jsx(D,{});case"wishlist":return e.jsx(O,{});case"orders":return e.jsx(E,{});case"subscriptions":return e.jsx(F,{});default:return e.jsx(y,{})}};return n?e.jsx("div",{className:"error-message",children:n}):e.jsx("div",{className:"profile-management",children:e.jsxs("div",{className:"container",children:[e.jsx("div",{className:c?"tabs show":"tabs",children:b()}),e.jsx("div",{className:"bars",onClick:f,children:c?e.jsx(C,{}):e.jsx(A,{})}),e.jsx("div",{className:"profile",children:e.jsx("div",{className:"profile-container",children:e.jsx("img",{src:o!=null&&o.profile_image?`http://127.0.0.1:8000/${o.profile_image}`:I,alt:"Profile",className:"proImage",loading:"lazy"})})}),e.jsx("div",{className:"contents",children:v()})]})})};export{M as default};
