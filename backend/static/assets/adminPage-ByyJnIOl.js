import{r as n,a as v,j as e,H as k,L as f,i as N,I as S,N as F,J as C,K as w,M as y,P as L,Q as I,S as U,T as _,x as A,U as E,O as P}from"./index-CqnK1jY6.js";import{e as $,f as D,g as O,h as R}from"./index-EUeODHB9.js";const B=()=>{const[a,h]=n.useState(!1),[s,c]=n.useState(null),[d,m]=n.useState(null),[t,o]=n.useState(!0),[u,x]=n.useState(null),p=v();n.useEffect(()=>{(async()=>{var g;const l=localStorage.getItem("access_token");if(!l){x("You must be logged in to view your profile."),o(!1);return}try{const r=await N.get("/users/me/",{headers:{Authorization:`Bearer ${l}`}});c(r.data)}catch(r){typeof r=="object"&&r!==null&&"response"in r&&((g=r.response)==null?void 0:g.status)===401?(x("Session expired. Please log in again."),localStorage.removeItem("access_token"),p("/login")):x("Failed to load profile.")}finally{o(!1)}})()},[p]);const j=i=>{m(l=>l===i?null:i)};if(t)return e.jsx("div",{className:"topnav-loading",children:"Loading..."});if(u)return e.jsx("div",{className:"topnav-error",children:u});const b=[{name:"",image:e.jsx("div",{className:"topnav-profile-image",children:e.jsx("img",{src:`http://127.0.0.1:8000/${s==null?void 0:s.profile_image}`,alt:`${s==null?void 0:s.first_name} ${s==null?void 0:s.last_name}`})}),path:"#",sublinks:[{name:"Profile",path:"/admin/profile"},{name:"Settings",path:"/admin/settings"},{name:"Reports",path:"/admin/reports"},{name:"Logout",path:"/admin/logout"},{name:"Help",path:"/admin/help"}]}];return e.jsxs("nav",{className:"topnav",children:[e.jsx("div",{className:"topnav-left",children:e.jsx("h2",{children:s==null?void 0:s.username})}),e.jsx("button",{title:"toggle",className:"topnav-toggle",onClick:()=>h(!a),children:e.jsx(k,{})}),e.jsx("div",{className:`topnav-right ${a?"open":""}`,children:e.jsx("ul",{className:"topnav-links",children:b.map((i,l)=>e.jsxs("li",{className:"topnav-item",children:[e.jsxs("div",{role:"button",className:"topnav-link",onClick:()=>i.sublinks&&j(l),children:[i.name," ",i.image]}),i.sublinks&&d===l&&e.jsx("ul",{className:"topnav-sublinks",children:i.sublinks.map((g,r)=>e.jsx("li",{className:"topnav-sublink-item",children:e.jsx(f,{to:g.path,className:"topnav-sublink-link",onClick:()=>m(null),children:g.name})},r))})]},l))})})]})},H=()=>{const[a,h]=n.useState(!1),s=v(),c=()=>{localStorage.removeItem("access_token"),s("/login")},d=()=>{h(!a)},m=[{name:"Dashboard",path:"/admin/overview",icon:e.jsx(w,{})},{name:"Users",path:"/admin/users",icon:e.jsx(y,{})},{name:"Products",path:"/admin/products",icon:e.jsx(L,{})},{name:"Orders",path:"/admin/orders",icon:e.jsx(I,{})},{name:"Invoices",path:"/admin/invoices",icon:e.jsx(U,{})},{name:"Blog",path:"/admin/blog",icon:e.jsx(O,{})},{name:"Report",path:"/admin/report",icon:e.jsx(_,{})},{name:"Help",path:"/admin/help",icon:e.jsx(R,{})}];return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:a?"sidebar shrink":"sidebar",children:[e.jsx("div",{className:"sidebar-header",children:e.jsx(f,{to:"/",children:e.jsx("img",{src:S,alt:""})})}),e.jsx("nav",{children:e.jsxs("ul",{className:"sidebar-links",children:[m.map(t=>e.jsx("li",{children:e.jsxs(F,{to:t.path,className:({isActive:o})=>`sidebar-link ${o?"active":""}`,children:[e.jsx("span",{className:"sidebar-icon",children:t.icon}),e.jsx("span",{className:a?"name":"",children:t.name})]})},t.name)),e.jsx("li",{children:e.jsxs("button",{className:a?"sidebar-link logout-button":"",onClick:c,children:[e.jsx(C,{}),e.jsx("span",{className:a?"name":"",children:"Logout"})]})})]})})]}),e.jsx("div",{className:a?"back-button slide-in":"back-button",onClick:()=>d(),children:a?e.jsx($,{}):e.jsx(D,{})})]})},M=()=>{const[a,h]=n.useState(null),[s,c]=n.useState(!0),[d,m]=n.useState(null),{setShowNav:t,setShowFooter:o}=A(),u=v();return n.useEffect(()=>(t(!1),o(!1),()=>{t(!0),o(!0)}),[t,o]),n.useEffect(()=>{(async()=>{const p=localStorage.getItem("access_token");if(!p){m("You must be logged in."),c(!1);return}try{const j=await N.get("/users/me/",{headers:{Authorization:`Bearer ${p}`}});h(j.data)}catch{localStorage.removeItem("access_token"),u("/login")}finally{c(!1)}})()},[u]),s?e.jsx("div",{className:"main",children:"Verifying admin access..."}):!a||a.role!=="admin"?e.jsx(E,{to:"/",replace:!0}):e.jsxs("div",{className:"admin-page",children:[e.jsx(H,{}),d&&e.jsx("div",{className:"alert alert-danger w-100 text-center",children:d}),e.jsxs("div",{className:"admin-content",children:[e.jsx(B,{}),e.jsx(P,{})]})]})};export{M as default};
