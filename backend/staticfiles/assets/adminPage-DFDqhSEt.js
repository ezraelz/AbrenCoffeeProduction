import{r as t,a as j,j as e,L as f,i as N,l as b,N as k,m as S,n as F,o as w,p as C,q as y,s as L,t as v,v as I,w as U,O as _}from"./index-CiTwIAPO.js";import{a as A,b as E,c as D,d as P}from"./index-J7B_vvGe.js";const $=()=>{const[s,m]=t.useState(null),[h,l]=t.useState(null),[c,d]=t.useState(!0),[a,i]=t.useState(null),u=j();t.useEffect(()=>{(async()=>{var p;const o=localStorage.getItem("access_token");if(!o){i("You must be logged in to view your profile."),d(!1);return}try{const r=await N.get("/users/me/",{headers:{Authorization:`Bearer ${o}`}});m(r.data)}catch(r){typeof r=="object"&&r!==null&&"response"in r&&((p=r.response)==null?void 0:p.status)===401?(i("Session expired. Please log in again."),localStorage.removeItem("access_token"),u("/login")):i("Failed to load profile.")}finally{d(!1)}})()},[u]);const x=n=>{l(o=>o===n?null:n)};if(c)return e.jsx("div",{className:"topnav-loading",children:"Loading..."});if(a)return e.jsx("div",{className:"topnav-error",children:a});const g=[{name:"",image:e.jsx("div",{className:"topnav-profile-image",children:e.jsx("img",{src:`http://127.0.0.1:8000/${s==null?void 0:s.profile_image}`,alt:`${s==null?void 0:s.first_name} ${s==null?void 0:s.last_name}`})}),path:"#",sublinks:[{name:"Profile",path:"/admin/profile"},{name:"Logout",path:"/logout"},{name:"Help",path:"/admin/help"}]}];return e.jsxs("nav",{className:"topnav",children:[e.jsx("div",{className:"topnav-left",children:e.jsx("h2",{children:s==null?void 0:s.username})}),e.jsx("div",{className:"topnav-right",children:e.jsx("ul",{className:"topnav-links",children:g.map((n,o)=>e.jsxs("li",{className:"topnav-item",children:[e.jsxs("div",{role:"button",className:"topnav-link",onClick:()=>n.sublinks&&x(o),children:[n.name," ",n.image]}),n.sublinks&&h===o&&e.jsx("ul",{className:"topnav-sublinks",children:n.sublinks.map((p,r)=>e.jsx("li",{className:"topnav-sublink-item",children:e.jsx(f,{to:p.path,className:"topnav-sublink-link",onClick:()=>l(null),children:p.name})},r))})]},o))})})]})},R=()=>{const[s,m]=t.useState(!1),h=j(),l=()=>{localStorage.removeItem("access_token"),h("/login")},c=()=>{m(!s)},d=[{name:"Dashboard",path:"/admin/overview",icon:e.jsx(F,{})},{name:"Users",path:"/admin/users",icon:e.jsx(w,{})},{name:"Products",path:"/admin/products",icon:e.jsx(C,{})},{name:"Orders",path:"/admin/orders",icon:e.jsx(y,{})},{name:"Invoices",path:"/admin/invoices",icon:e.jsx(L,{})},{name:"Blog",path:"/admin/blog",icon:e.jsx(D,{})},{name:"Subscriptions",path:"/admin/subscriptions",icon:e.jsx(v,{})},{name:"Report",path:"/admin/report",icon:e.jsx(v,{})},{name:"Help",path:"/admin/help",icon:e.jsx(P,{})}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sidebar-toggle",onClick:()=>c(),children:s?e.jsx(A,{}):e.jsx(E,{})}),e.jsxs("aside",{className:s?"sidebar shrink":"sidebar",children:[e.jsx("div",{className:"sidebar-header",children:e.jsx(f,{to:"/",children:e.jsx("img",{src:b,alt:""})})}),e.jsx("nav",{children:e.jsxs("ul",{className:"sidebar-links",children:[d.map(a=>e.jsx("li",{children:e.jsxs(k,{to:a.path,className:({isActive:i})=>`sidebar-link ${i?"active":""}`,children:[e.jsx("span",{className:"sidebar-icon",children:a.icon}),e.jsx("span",{className:s?"name":"",children:a.name})]})},a.name)),e.jsx("li",{children:e.jsxs("button",{className:s?"sidebar-link logout-button":"",onClick:l,children:[e.jsx(S,{}),e.jsx("span",{className:s?"name":"",children:"Logout"})]})})]})})]})]})},H=()=>{const[s,m]=t.useState(null),[h,l]=t.useState(!0),[c,d]=t.useState(null),{setShowNav:a,setShowFooter:i}=I(),u=j();return t.useEffect(()=>(a(!1),i(!1),()=>{a(!0),i(!0)}),[a,i]),t.useEffect(()=>{(async()=>{const g=localStorage.getItem("access_token");if(!g){d("You must be logged in."),l(!1);return}try{const n=await N.get("/users/me/",{headers:{Authorization:`Bearer ${g}`}});m(n.data)}catch{localStorage.removeItem("access_token"),u("/login")}finally{l(!1)}})()},[u]),h?e.jsx("div",{className:"main",children:"Verifying admin access..."}):!s||s.role!=="admin"?e.jsx(U,{to:"/",replace:!0}):e.jsxs("div",{className:"admin-page",children:[e.jsx(R,{}),c&&e.jsx("div",{className:"alert alert-danger w-100 text-center",children:c}),e.jsxs("div",{className:"admin-content",children:[e.jsx($,{}),e.jsx(_,{})]})]})};export{H as default};
