import{r as a,a as k,j as e,i as j,y as x}from"./index-CYbfX4g-.js";import y from"./adminPage-CvSFWlll.js";import"./index-BJQuPtR-.js";const f=()=>{const[s,i]=a.useState(null),[c,o]=a.useState(null),l=k();return a.useEffect(()=>{(async()=>{const d=localStorage.getItem("access_token");if(!d){o("You must be logged in to view your profile.");return}try{const r=await j.get("/users/me/",{headers:{Authorization:`Bearer ${d}`}});i(r.data)}catch{o("Failed to load profile.")}})()},[l]),c?e.jsx("div",{className:"error-message",children:c}):e.jsx("div",{className:"profile",children:e.jsxs("div",{className:"profile-container",children:[e.jsx("img",{src:`http://127.0.0.1:8000${s==null?void 0:s.profile_image}`,alt:"Profile"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",s==null?void 0:s.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s==null?void 0:s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",s==null?void 0:s.role]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date Joined:"})," ",s==null?void 0:s.date_joined]})]})})},b=()=>{const[s,i]=a.useState(null);return a.useEffect(()=>{(async()=>{const o=localStorage.getItem("access_token");if(o)try{const l=await j.get("/orders/shipping/user/",{headers:{Authorization:`Bearer ${o}`}});console.log("Shipping Response:",l.data),Array.isArray(l.data)&&l.data.length>0?i(l.data[0]):i(null)}catch{x.error("Shipping fetch failed:")}})()},[]),e.jsx("div",{children:e.jsxs("div",{className:"profile-shipping-container",children:[e.jsx("h2",{children:"Shipping Address"}),s?e.jsxs("div",{className:"shipping-details",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",s.full_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address 1:"})," ",s.address1]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address 2:"})," ",s.address2]}),e.jsxs("p",{children:[e.jsx("strong",{children:"City:"})," ",s.city]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",s.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Zipcode:"})," ",s.zipcode]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Country:"})," ",s.country]})]}):e.jsx("p",{className:"no-address",children:"No shipping address found."})]})})},A=()=>{const[s,i]=a.useState([]),[c,o]=a.useState(!1),l=async()=>{o(!0);try{const t=localStorage.getItem("access_token"),d=await j.get("/orders/invoices/user/",{headers:t?{Authorization:`Bearer ${t}`}:{}});i(d.data),console.log("Invoices loaded:",d.data)}catch(t){console.error("Error loading invoices:",t),x.error("❌ Failed to load invoices")}o(!1)};return a.useEffect(()=>{l()},[]),e.jsxs("div",{className:"invoices-container",children:[e.jsx("h1",{children:"All Invoices"}),c?e.jsx("p",{children:"Loading..."}):e.jsxs("table",{className:"invoices-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Invoice ID"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.id}),e.jsx("td",{children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{children:t.status}),e.jsxs("td",{className:"action-buttons",children:[e.jsx("button",{onClick:()=>alert(`Viewing ${t.id}`),children:"View"}),e.jsx("button",{onClick:()=>alert(`Editing ${t.id}`),children:"Edit"}),e.jsx("button",{onClick:()=>alert(`Deleting ${t.id}`),children:"Delete"}),t.pdf_file&&e.jsx("a",{href:t.pdf_file,target:"_blank",rel:"noopener noreferrer",download:!0,className:"download-link",children:e.jsx("button",{children:"Download"})})]})]},t.id))})]}),s.length===0&&!c&&e.jsx("p",{children:"No invoices found."})]})},w=()=>{const[s,i]=a.useState([]),[c,o]=a.useState(1),l=k(),t=5;a.useEffect(()=>{(async()=>{const h=localStorage.getItem("access_token"),u=await j.get("/orders/list/",{headers:{Authorization:`Bearer ${h}`}});i(u.data),console.log(u.data)})()},[]);const d=s,r=c*t,p=r-t,m=d.slice(p,r),v=Math.ceil(d.length/t),N=async n=>{try{const h=localStorage.getItem("access_token");await j.post(`/orders/${n}/cancel/`,{},{headers:{Authorization:`Bearer ${h}`}}),x.success("Order cancelled and stock restored."),i(u=>u.filter(g=>g.id!==n))}catch{x.error("Failed to cancel order.")}},S=async n=>{try{const h=localStorage.getItem("access_token");await j.post(`/orders/request-refund/${n}/`,{},{headers:{Authorization:`Bearer ${h}`}}),x.success("Refund request sent!"),i(u=>u.map(g=>g.id===n?{...g,refundRequested:!0}:g))}catch{x.error("Failed to request refund.")}};return e.jsxs("div",{className:"order-list",children:[e.jsx("h1",{children:"All Orders"}),e.jsx("div",{className:"order-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Total price"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:m.length>0?m.map((n,h)=>e.jsxs("tr",{children:[e.jsx("td",{children:h+1+(c-1)*t}),e.jsx("td",{children:n.status}),e.jsx("td",{children:n.total_price}),e.jsxs("td",{children:[n.status==="pending"?e.jsxs("div",{className:"pending-order-actions",children:[e.jsx("button",{onClick:()=>l("/checkout/payment",{state:{orderId:n.id}}),className:"btn-primary",children:"💳 Resume Payment"}),e.jsx("button",{onClick:()=>N(n.id),className:"btn-secondary",children:"❌ Cancel Order"})]}):e.jsx("button",{className:"btn-edit",title:"View Order",onClick:()=>alert(`View details for order ${n.id}`),children:"✏️ Info"}),n.status==="delivered"&&!n.refundRequested&&e.jsx("button",{onClick:()=>S(n.id),children:"Request Refund"})]})]},n.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No Orders found."})})})]})}),e.jsx("div",{className:"pagination",children:[...Array(v).keys()].map(n=>e.jsx("button",{onClick:()=>o(n+1),className:c===n+1?"active":"",children:n+1},n+1))})]})},O=()=>{const[s,i]=a.useState("profile"),c=!!localStorage.getItem("access_token");a.useEffect(()=>{(async()=>{const r=localStorage.getItem("access_token");try{await j.get("/users/me/",{headers:{Authorization:`Bearer ${r}`}})}catch{localStorage.removeItem("access_token"),x.error("Failed to load profile.")}})()},[]);const o=()=>{localStorage.removeItem("access_token"),window.location.href="/login"},l=()=>{const d=[{name:"profile"},{name:"shipping address"},{name:"orders"},{name:"wishlist"},{name:"invoices"},{name:c?"Logout":"",to:"",onClick:o},{name:"settings"}].filter(r=>r.name);return e.jsx("div",{className:"profile-tab-container",children:d.map((r,p)=>e.jsx("button",{onClick:()=>{i(r.name),r.onClick&&r.onClick()},className:s===r.name?"active":"",children:r.name},p))})},t=()=>{switch(s){case"Profile":return e.jsx(f,{});case"shipping address":return e.jsx(b,{});case"dashboard":return e.jsx(y,{});case"invoices":return e.jsx(A,{});case"orders":return e.jsx(w,{});default:return e.jsx(f,{})}};return e.jsx("div",{className:"profile-management",children:e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"contents",children:t()}),e.jsx("div",{className:"tabs",children:l()})]})})};export{O as default};
