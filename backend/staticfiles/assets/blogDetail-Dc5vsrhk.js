import{R as C,r as o,j as e,u as k,i as x,a as $}from"./index-BZFXry5G.js";import{B as v}from"./backbutton-DW9GSHi3.js";const _=({comments:l,onCommentSubmit:u})=>{const[n,r]=C.useState(""),[d,a]=o.useState(!1);o.useEffect(()=>{(async()=>{if(!d)return;const f=localStorage.getItem("access_token");a(!!f)})()},[d]);const j=()=>{n.trim()&&(u(n),r(""))};return e.jsxs("div",{className:"blog-comment-container",children:[e.jsxs("h3",{children:["Comments (",l.length,")"]}),e.jsx("ul",{className:"comment-list",children:l.map(c=>e.jsxs("li",{className:"comment-item",children:[e.jsxs("div",{className:"comment-meta",children:[e.jsx("strong",{children:c.author_username})," ·"," ",new Date(c.created_at).toLocaleDateString()]}),e.jsx("div",{className:"comment-text",children:c.content})]},c.id))}),e.jsx("textarea",{className:"comment-input",value:n,onChange:c=>r(c.target.value),placeholder:"Add a comment...",rows:4}),e.jsx("button",{className:"comment-submit",onClick:j,disabled:!n.trim(),children:d?"Submit":"comment"})]})},w=[{type:"like",emoji:"👍"},{type:"dislike",emoji:"👎"},{type:"love",emoji:"❤️"},{type:"funny",emoji:"😂"},{type:"sad",emoji:"😢"},{type:"angry",emoji:"😠"}],R=({blogId:l})=>{const[u,n]=o.useState([]),[r,d]=o.useState(null),[a,j]=o.useState(!1),{id:c}=k(),f=async()=>{try{const t=localStorage.getItem("access_token"),m=(await x.get(`/blog/detail/${c}/`,{headers:t?{Authorization:`Bearer ${t}`}:{}})).data;n(m.reaction_summary||[])}catch(t){console.error("Failed to fetch reactions:",t)}};o.useEffect(()=>{f()},[l]);const p=async t=>{const i=localStorage.getItem("access_token");if(!i)return alert("Login to react.");j(!0);try{r===t?(await x.delete(`/blog/reaction/delete/${l}/`,{headers:{Authorization:`Bearer ${i}`}}),d(null)):(await x.post(`/blog/reaction/create/${l}/`,{reaction:t},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}}),d(t)),f()}catch(m){console.error("Failed to react:",m)}finally{j(!1)}};return e.jsxs("div",{className:"reaction-buttons",children:[e.jsx("h5",{children:"Reactions"}),e.jsx("div",{className:"reaction-list",children:w.map(({type:t,emoji:i})=>{var b;const m=((b=u.find(y=>y.reaction===t))==null?void 0:b.count)||0,N=r===t;return e.jsxs("button",{onClick:()=>p(t),disabled:a,className:`reaction-btn ${N?"active":""}`,children:[i," ",e.jsx("small",{children:m>0?`${m}`:"0"})]},t)})})]})},S="https://abrencoffeeproduction.onrender.com",A=()=>{const[l,u]=o.useState([]),{id:n}=k(),[r,d]=o.useState(!1),[a,j]=o.useState(null),[c,f]=o.useState([]),[p,t]=o.useState(!0),[i,m]=o.useState(""),N=$();o.useEffect(()=>{n&&(async()=>{try{const h=(await x.get(`/blog/detail/${n}/`)).data;j(h.blog),u(h.comments||[])}catch(g){console.error("Failed to fetch blog detail:",g),m("Failed to load the blog post. Please try again.")}finally{t(!1)}})()},[n]),o.useEffect(()=>{const s=localStorage.getItem("access_token");(async()=>{try{const h=await x.get("/blog/list/",{headers:s?{Authorization:`Bearer ${s}`}:{},withCredentials:!0});f(h.data)}catch(h){console.error("Failed to fetch blog data:",h)}finally{t(!1)}})()},[]);const b=async s=>{if(s.trim())try{const g=localStorage.getItem("access_token"),h=await x.post(`/blog/comment/create/${n}/`,{content:s},{headers:g?{Authorization:`Bearer ${g}`}:{}});u(B=>[...B,h.data])}catch(g){console.error("Failed to submit comment:",g)}};if(p)return e.jsx("p",{className:"blog-loading",children:"Loading post..."});if(i)return e.jsx("p",{className:"blog-error",children:i});if(!a)return e.jsx("p",{className:"blog-empty",children:"No blog post found."});const y=a.image.startsWith("http")?a.image:`${S}${a.image}`;return e.jsxs("article",{className:"blog-detail",children:[e.jsx(v,{}),e.jsxs("section",{className:"blog-detail-body",children:[e.jsx("header",{className:"blog-detail-header",children:e.jsx("h1",{className:"blog-detail-title",children:a.title})}),e.jsx("img",{src:y,alt:a.title,className:"blog-detail-image"}),e.jsxs("div",{className:"blog-detail-content",children:[e.jsxs("p",{className:"blog-detail-meta",children:["By ",e.jsx("strong",{children:a.author_username})," ·"," ",new Date(a.created_at).toLocaleDateString()]}),e.jsxs("p",{className:"blog-detail-dicription",children:[r?a.content.slice(0,1e3):a.content.slice(0,360),e.jsx("span",{onClick:()=>d(!r),children:r?" Less":" ...More"})]}),e.jsx(R,{blogId:n})]}),e.jsx(_,{comments:l.map(s=>({...s,created_at:typeof s.created_at=="string"?Date.parse(s.created_at):s.created_at})),onCommentSubmit:b}),e.jsxs("div",{className:"related-blogs",children:[e.jsx("h4",{children:"Related Blogs"}),c.length===0?e.jsx("p",{children:"No blogs found!"}):e.jsx(e.Fragment,{children:c.map(s=>e.jsxs("div",{className:"related-blog-card",onClick:()=>N(`blog/detail/${s.id}`),children:[e.jsx("img",{src:`${S}/${s.image}`,alt:""}),e.jsxs("div",{className:"related-blog-info",children:[e.jsx("p",{children:s.author_username}),e.jsxs("p",{children:["comments ",l.length]})]})]},s.id))})]})]})]})};export{A as default};
